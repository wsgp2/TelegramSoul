#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–º
"""

from chatgpt_analyzer import ChatGPTAnalyzer
import os

def test_beautiful_format():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –∫—Ä–∞—Å–∏–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–º–∏—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞)
    test_topics_data = {
        "topics": [
            {
                "name": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –∏ –±–∏–∑–Ω–µ—Å",
                "keywords": ["–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "–±–∏–∑–Ω–µ—Å", "—Å—Ç–∞—Ä—Ç–∞–ø", "–¥–µ–Ω—å–≥–∏"],
                "percentage": 22.3,
                "sentiment": "positive",
                "description": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, –±–∏–∑–Ω–µ—Å-–∏–¥–µ–π –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ä–∞–∑–≤–∏—Ç–∏—è"
            },
            {
                "name": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ —Ç—É—Ä–∏–∑–º", 
                "keywords": ["–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", "–æ—Ç–ø—É—Å–∫", "—Å—Ç—Ä–∞–Ω—ã", "–æ—Ç–µ–ª–∏"],
                "percentage": 18.7,
                "sentiment": "positive",
                "description": "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–µ–∑–¥–æ–∫, –æ–±–º–µ–Ω –æ–ø—ã—Ç–æ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–µ—Å—Ç"
            },
            {
                "name": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ IT",
                "keywords": ["—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "AI", "—Å–æ—Ñ—Ç"],
                "percentage": 15.2,
                "sentiment": "neutral",
                "description": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ IT-—Ç—Ä–µ–Ω–¥–æ–≤"
            },
            {
                "name": "–õ–∏—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ",
                "keywords": ["—Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–Ω–∞–≤—ã–∫–∏", "—Ä–æ—Å—Ç"],
                "percentage": 12.8,
                "sentiment": "positive", 
                "description": "–°–∞–º–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, —Ä–∞–∑–≤–∏—Ç–∏–µ –Ω–∞–≤—ã–∫–æ–≤, –ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç"
            },
            {
                "name": "–ó–¥–æ—Ä–æ–≤—å–µ –∏ —Å–ø–æ—Ä—Ç",
                "keywords": ["–∑–¥–æ—Ä–æ–≤—å–µ", "—Å–ø–æ—Ä—Ç", "—Ñ–∏—Ç–Ω–µ—Å", "–ø–∏—Ç–∞–Ω–∏–µ"],
                "percentage": 8.4,
                "sentiment": "positive",
                "description": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏ –∏ –ø–∏—Ç–∞–Ω–∏—è"
            },
            {
                "name": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
                "keywords": ["—Ñ–∏–ª—å–º—ã", "–∏–≥—Ä—ã", "–º—É–∑—ã–∫–∞", "–¥–æ—Å—É–≥"],
                "percentage": 4.2,
                "sentiment": "positive",
                "description": "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ñ–∏–ª—å–º–æ–≤, –∏–≥—Ä, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π"
            }
        ]
    }
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –æ—Ü–µ–Ω–∫–∏
    test_commercial_assessment = {
        "commercial_assessment": [
            {
                "topic": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –∏ –±–∏–∑–Ω–µ—Å",
                "commercial_score": "–í—ã—Å–æ–∫–∏–π –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª",
                "products": [
                    {
                        "name": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏",
                        "description": "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º",
                        "revenue_potential": "–≤—ã—Å–æ–∫–∏–π"
                    },
                    {
                        "name": "–ö—É—Ä—Å –ø–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏",
                        "description": "–û–±—É—á–∞—é—â–∏–π –∫—É—Ä—Å –ø–æ –æ—Å–Ω–æ–≤–∞–º –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
                        "revenue_potential": "—Å—Ä–µ–¥–Ω–∏–π"
                    }
                ]
            },
            {
                "topic": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ —Ç—É—Ä–∏–∑–º",
                "commercial_score": "–°—Ä–µ–¥–Ω–∏–π –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª",
                "products": [
                    {
                        "name": "–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π",
                        "description": "–°–µ—Ä–≤–∏—Å –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–µ–∑–¥–æ–∫",
                        "revenue_potential": "—Å—Ä–µ–¥–Ω–∏–π"
                    }
                ]
            }
        ]
    }
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö API –∫–ª—é—á–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞)
    try:
        analyzer = ChatGPTAnalyzer(api_key="test_key")
    except:
        # –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        analyzer = ChatGPTAnalyzer.__new__(ChatGPTAnalyzer)
        analyzer.output_dir = "data/reports"
        os.makedirs(analyzer.output_dir, exist_ok=True)
    
    print("üéØ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–†–ê–°–ò–í–û–ì–û –§–û–†–ú–ê–¢–ê –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –¢–ï–ú")
    print("=" * 60)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–º
    print("\nüíé –ö–†–ê–°–ò–í–´–ô –§–û–†–ú–ê–¢ –¢–ï–ú:")
    print("-" * 40)
    beautiful_topics = analyzer.generate_beautiful_topic_format(test_topics_data)
    print(beautiful_topics)
    
    print("\n" + "=" * 60)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á–µ—Ç
    print("\nüìä –ü–û–õ–ù–´–ô –ö–†–ê–°–ò–í–´–ô –û–¢–ß–ï–¢:")
    print("-" * 40)
    beautiful_report = analyzer.generate_beautiful_client_report(
        test_topics_data, 
        test_commercial_assessment, 
        "–¢–µ—Å—Ç–æ–≤—ã–π –ö–ª–∏–µ–Ω—Ç"
    )
    print(beautiful_report)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
    report_path = os.path.join(analyzer.output_dir, "–¢–ï–°–¢_–∫—Ä–∞—Å–∏–≤—ã–π_–æ—Ç—á–µ—Ç.md")
    with open(report_path, 'w', encoding='utf-8') as f:
        f.write(beautiful_report)
    
    print(f"\nüíæ –¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {report_path}")
    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!")

if __name__ == "__main__":
    test_beautiful_format() 